var u={},$=(v,S,I)=>(u.__chunk_518=(T,d,p)=>{"use strict";async function f(e,r,o="POST"){let t={Authorization:`Bearer ${function(){let n=process.env.STRIPE_SECRET_KEY;if(!n)throw Error("STRIPE_SECRET_KEY not configured");return n}()}`,"Content-Type":"application/x-www-form-urlencoded"},s=await fetch(`https://api.stripe.com/v1${e}`,{method:o,headers:t,body:r?Object.entries(r).map(([n,c])=>`${encodeURIComponent(n)}=${encodeURIComponent(c)}`).join("&"):void 0}),a=await s.json();if(!s.ok)throw Error(a.error?.message||`Stripe API error: ${s.status}`);return a}async function _(e){let r={mode:"subscription","line_items[0][price]":e.priceId,"line_items[0][quantity]":"1",success_url:e.successUrl,cancel_url:e.cancelUrl,allow_promotion_codes:"true"};if(e.customerEmail&&(r.customer_email=e.customerEmail),e.clientReferenceId&&(r.client_reference_id=e.clientReferenceId),e.metadata)for(let[o,t]of Object.entries(e.metadata))r[`metadata[${o}]`]=t;return f("/checkout/sessions",r)}async function h(e,r,o){try{let t=r.split(",").reduce((i,y)=>{let[l,m]=y.split("=");return l==="t"&&(i.timestamp=m),l==="v1"&&i.signatures.push(m),i},{timestamp:"",signatures:[]});if(!t.timestamp||t.signatures.length===0)return{valid:!1,error:"Invalid signature format"};let s=Math.floor(Date.now()/1e3);if(Math.abs(s-parseInt(t.timestamp))>300)return{valid:!1,error:"Timestamp outside tolerance"};let a=`${t.timestamp}.${e}`,n=new TextEncoder,c=n.encode(o),g=await crypto.subtle.importKey("raw",c.buffer,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),w=n.encode(a),E=await crypto.subtle.sign("HMAC",g,w.buffer),b=Array.from(new Uint8Array(E)).map(i=>i.toString(16).padStart(2,"0")).join("");return t.signatures.some(i=>i===b)?{valid:!0,event:JSON.parse(e)}:{valid:!1,error:"Signature mismatch"}}catch(t){return{valid:!1,error:t.message||"Verification failed"}}}p.d(d,{fw:()=>_,t6:()=>h})},u);export{$ as __getNamedExports};
